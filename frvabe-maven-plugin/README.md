# FrVaBe Maven Plugin

> Maven is - at its heart - a plugin execution framework; all work is done by plugins.

This quote is the start of the [Maven Plugins documentation](https://maven.apache.org/plugins/index.html). Thus, if you want to customize your Maven build project you should think about using a special plugin. If no plugin for your task is available you have the possibility to write your own.

There is some information available that helps you to write your own plugin via the [Plugin Developer Center](https://maven.apache.org/plugin-developers/index.html). I recommend reading the provided documents as far as they touch your needs.
One of the most important documents to read is the [Your First Mojo](https://maven.apache.org/guides/plugin/guide-java-plugin-development.html) guide.

**What is it about the FrVaBe Maven plugin?**

The **frvab-maven-plugin** is a plugin showcase to demonstrate the basic tasks on
* how to _write_ a Maven plugin and
* how to _document_ it.

I put detailed documentation to the code and the configuration files to make them understandable. Nevertheless I will also describe the basic tasks in this README document. So let's go...

## How-To write a Maven plugin

To write a simple Maven plugin is not too difficult. Relevant steps are

**find a proper name**

Find a proper name for your artifactId. It should be named by the following schema

     <artifactId>${myName}-maven-plugin</artifactId>

and NOT _maven-${myName}-plugin_. Otherwise you would violate the [Apache Maven Tademark](https://maven.apache.org/guides/plugin/guide-java-plugin-development.html).

Using "-maven-plugin" as the artifactId suffix ensures that you can use the short form `${myName}` on the command line because of Mavens [Plugin Prefix Resolution](https://maven.apache.org/guides/introduction/introduction-to-plugin-prefix-mapping.html).

**choose the right packaging type**

The pom packing type of your Maven plugin artifact has to be

    <packaging>maven-plugin</packaging>

In this case a Maven [Plugin Descriptor](https://maven.apache.org/ref/3.3.9/maven-plugin-api/plugin.html) will be generated by the [Maven Plugin Plugin](https://maven.apache.org/plugin-tools/maven-plugin-plugin/) plugin.

**declare necessary denpencies**

```xml
<!-- Annotations that are used in Mojo classes to label Mojos and
	Parameters are located in the 'maven-plugin-annotations' artifact -->
<dependency>
	<groupId>org.apache.maven.plugin-tools</groupId>
	<artifactId>maven-plugin-annotations</artifactId>
	<version>3.4</version>
	<scope>provided</scope>
</dependency>

<!-- Abstract implementations of Mojos, Exceptions and other things
	are located in the 'maven-plugin-api' artifact -->
<dependency>
	<groupId>org.apache.maven</groupId>
	<artifactId>maven-plugin-api</artifactId>
	<version>3.3.9</version>
</dependency>

<!-- If a handle to the Maven project is required the 'maven-core'
	artifact will be necessary too. -->
<dependency>
	<groupId>org.apache.maven</groupId>
	<artifactId>maven-core</artifactId>
	<version>3.3.9</version>
</dependency>
```
**write a plugin goal (Mojo)**

A goal in a Maven plugin is called a 'Mojo'. A 'Mojo' is a class in the dependency plugin code and will probably extend [AbstractMojo](https://maven.apache.org/maven-plugin-api/apidocs/org/apache/maven/plugin/AbstractMojo.html) (from the [Mojo API](https://maven.apache.org/developers/mojo-api-specification.html)) and use the [@Mojo](https://maven.apache.org/plugin-tools/maven-plugin-annotations/apidocs/org/apache/maven/plugins/annotations/Mojo.html) annotation.

```java
@Mojo(name = "hello-world", requiresProject = false, defaultPhase = LifecyclePhase.GENERATE_SOURCES)
public class HelloWorldMojo extends AbstractMojo {
```

Parameters will be annotated with [@Parameter](https://maven.apache.org/plugin-tools/maven-plugin-annotations/apidocs/org/apache/maven/plugins/annotations/Parameter.html).

```java
@Parameter(defaultValue = DEFAULT_MESSAGE, property = "frvabe.message")
private String message;
```

It is recommended to use a special prefix for the parameter command line property to avoid conflicts with equally named parameters of other plugins.

@Mojo and @Parameter are probably the most relevant annotations inside a Mojo but some other are supported as well. Have a look at the [Maven Plugin Tool for Annotations](https://maven.apache.org/components/plugin-tools/maven-plugin-tools-annotations/index.html) documentation for further information of supported annotations and their usage.

Finally the code that should be executed when the plugin goal is called must be implemented in the _execute_ method

```java    
@Override
public void execute() throws MojoExecutionException, MojoFailureException {
```

**build**

Thats should be just a simple Maven build of your plugin project

    > mvn clean install|deploy

**execute**

Maven plugins can be added to the build section of a projects pom. The configuration of each plugin follows the same rules. Take a look at the [Guide to Configuring Plug-ins](https://maven.apache.org/guides/mini/guide-configuring-plugins.html) documentation.  
 Furthermore you can also invoke a plugin goal from the command line (if you are interested in the differences the [Guide to Configuring Default Mojo Executions](https://maven.apache.org/guides/mini/guide-default-execution-ids.html) and this [SO answer](http://stackoverflow.com/questions/34590452/what-is-the-implicit-id-of-a-maven-plugin-execution) might be a good further read).

Depending on the plugin prefix resolution the execution of the _hello-word_ goal of this _frvabe-maven-plugin_ would be done this way:

_long syntax_
    > mvn de.frvabe.maven.plugins:frvabe-maven-plugin:${project.version}:hello-world
_short syntax_
    > mvn frvabe:hello-world

## How-To document a Maven plugin

The Maven project defined a [Plugin Documentation Standard](https://maven.apache.org/guides/development/guide-plugin-documentation.html). I really, really like it and I think it was a smart step to define and support a standard. If you once understood [How to read a Maven Plugin Documentation](http://frvabe.blogspot.de/2013/12/how-to-read-maven-plugin-documentation.html) it will be easy for you to find your way around in any plugin documentation.

As a consequence - as a plugin provider - you should also provide your plugin documentation in the documentation standard. So here are the basic informations how to do it.

The first thing you have to know is that the plugin documentation will be generated. It is a mix of documents you need to provide (in the [src/site](src/site) directory) and automatically generated sites (derived from the pom.xml and the Mojo classes of the plugin project). The generation will be done by the [Maven Plugin Plugin](https://maven.apache.org/plugin-tools/maven-plugin-plugin/).

Have a look at the [Plugin Documentation Standard](https://maven.apache.org/guides/development/guide-plugin-documentation.html). The code examples on this site are somehow outdated (JavaDoc tags are used instead of annotations to define Mojos and parameters) but you will find detailed information which information of the plugin project will be used to generated parts of the documentation. In short you should
* provide significant informations in your plugin pom.xml
* write proper JavaDoc for Mojos and their parameters

The generation process of the Maven plugin documentation will create
* a **plugin-info.html** site which is the overview site of your plugin goals and
* a single **&lt;mygoal&gt;-mojo.html** sites for each goal of your plugin

The _Maven Plugin Plugin_ will generate parts of the plugin documentation. The overall documentation however will be assembled by the [Maven Site Plugin](https://maven.apache.org/plugins/maven-site-plugin/) and therefore the [Guide to creating a site](https://maven.apache.org/guides/mini/guide-site.html) is a must known resource.

The layout of a site is specified by the _src/site/site.xml_ file which is called the **Site Descriptor**. An example file to document your Maven plugin can be found in the Plugin Documentation Standard  [here](https://maven.apache.org/guides/development/guide-plugin-documentation.html#Site_Descriptor).

Using this file will generate a documentation with an "old" look. By now the documentation skin is [customizable](http://maven.apache.org/skins/) and a modern [Maven Fluido Style](http://maven.apache.org/skins/maven-fluido-skin/) exsist. Most Apache Maven related sites use this skin and you probably will like to do so too. The frvabe-maven-plugin does also use this style and the [site.xml](src/site/site.xml) shows how to do so.

You will probably define some navigation links in the site descriptor, like a link to a _Usage_ page. This content hase to be provided by your own. The Site Plugin supports several document formats. The _fravabe-maven-plugin_ uses Markdown as it is a well known format these days. The usage page e.g. is provided in the [src/site/markdown/usage.md.vm](src/site/markdown/usage.md.vm) file.

The **".vm"** extension can be added to content files of any supported documentation format. In this case Apache Velocity will be used for [filtering](http://maven.apache.org/plugins/maven-site-plugin/examples/creating-content.html#Filtering). Filtering enables you to use placeholder like _${project.version}_ in your content files. These placeholder will be replaced by the current values defined in the pom.xml during site generation.

If you have your site descriptor (src/site/site.xml), your content (src/site/{format}/...) and your JavaDoc in place you are able to build the documentation. You just need to add the Maven Plugin Plugin to the reporting section of your plugin pom.

```xml   
<reporting>
    <plugins>
        <!-- The Maven Plugin Plugin is used to generate some documentation
            resources like 'plugin-info.html' and '<goal>-mojo.html'. See: https://maven.apache.org/plugin-tools/maven-plugin-plugin/ -->
        <plugin>
            <groupId>org.apache.maven.plugins</groupId>
            <artifactId>maven-plugin-plugin</artifactId>
            <version>3.5</version>
        </plugin>
    </plugins>
</reporting>
```

Now just build your project and create the site with the following mvn commands
```
> mvn install
> mvn site
```
The `mvn site` command calls the site phase of the site Lifecycle (see difference between [mvn site and mvn site:site](https://maven.apache.org/plugins/maven-site-plugin/faq.html#What_is_the_difference_between_mvn_site_and_mvn_site:site)). This will invoke the [site](https://maven.apache.org/plugins/maven-site-plugin/site-mojo.html) goal of the Maven Site Plugin. The generated site will afterwards be located inside the _target/site_ directory.

# TL;DR

The **[frvabe-maven-plugin](frvabe-maven-plugin)** is a sample Maven plugin implementation. The code provides comments which try to explain the main characteristics of a Maven plugin. Take a look and discover the 'secrets' on your own ;-)

Beside the plugin implementation the project also provides the content to generate a standard plugin documentation ([src/site](src/site)). Use `mvn install` and `mvn site` to generate the plugin documentation. Open the generated documentation at _target/site/index.html_ and explore how the plugin works.

Another template of a Maven Plugin project can be generated by using the [Maven Mojo archetype](https://maven.apache.org/guides/plugin/guide-java-plugin-development.html#Mojo_archetype). Although it does not use the latest versions it will probably work and also covers a litte section on plugin testing.
